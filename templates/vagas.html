{% extends "base.html" %}

{% block conteudo %}
<h2>Oportunidades Dispon√≠veis</h2>

<div class="layout-vagas">
    <!-- BOT√ÉO TOGGLE (mobile) -->
    <button class="btn btn-primario toggle-filtros" onclick="toggleFiltros()">‚öôÔ∏è Filtros</button>

    <!-- FILTROS -->
    <aside class="filtros" id="sidebar-filtros">
        <h3>Pesquisa Avan√ßada</h3>
        <form method="GET" action="{{ url_for('pagina_vagas') }}">
            <label for="q">Texto (t√≠tulo/descri√ß√£o):</label>
            <input type="text" id="q" name="q" value="{{ filtros.q }}">

            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" value="{{ filtros.cidade }}">

            <label for="categoria">Categoria:</label>
            <input type="text" id="categoria" name="categoria" value="{{ filtros.categoria }}" placeholder="ex.: Inform√°tica">

            <label for="horario">Tipo de Hor√°rio:</label>
            <select id="horario" name="horario">
                <option value="">-- Todos --</option>
                <option value="full-time" {% if filtros.horario=='full-time' %}selected{% endif %}>Full-time</option>
                <option value="part-time" {% if filtros.horario=='part-time' %}selected{% endif %}>Part-time</option>
                <option value="remoto" {% if filtros.horario=='remoto' %}selected{% endif %}>Remoto</option>
            </select>

            <label for="tipo">Tipo de Oportunidade:</label>
            <select id="tipo" name="tipo">
                <option value="">-- Todas --</option>
                <option value="emprego" {% if filtros.tipo=='emprego' %}selected{% endif %}>Emprego</option>
                <option value="estagio" {% if filtros.tipo=='estagio' %}selected{% endif %}>Est√°gio</option>
                <option value="bolsa" {% if filtros.tipo=='bolsa' %}selected{% endif %}>Bolsa</option>
            </select>

            <button type="submit" class="btn btn-sucesso">üîç Filtrar</button>
        </form>
        <p style="margin-top:10px;">Resultado: <b>{{ total }}</b> vagas</p>
    </aside>

    <!-- LISTAGEM DE VAGAS -->
    <section class="vagas-lista">
        {% for vaga in vagas %}
            <div class="card vaga-card">
                <h3>{{ vaga.titulo }}</h3>
                {% if vaga.categoria %}<p><b>Categoria:</b> {{ vaga.categoria }}</p>{% endif %}
                {% if vaga.cidade %}<p><b>Cidade:</b> {{ vaga.cidade }}</p>{% endif %}
                {% if vaga.horario %}<p><b>Hor√°rio:</b> {{ vaga.horario }}</p>{% endif %}
                {% if vaga.tipo %}<p><b>Tipo:</b> {{ vaga.tipo }}</p>{% endif %}
                <p>{{ vaga.descricao[:140] }}...</p>

                {% if vaga.externa %}
                    <a href="{{ vaga.link_externo }}" target="_blank" class="btn btn-primario">üåê Abrir site</a>
                {% else %}
                    <a href="{{ url_for('detalhes_vaga', vaga_id=vaga.id) }}" class="btn btn-primario">üëÅ Ver detalhes</a>
                {% endif %}
            </div>
        {% else %}
            <p>Nenhuma vaga encontrada com os filtros atuais.</p>
        {% endfor %}

        <!-- Pagina√ß√£o -->
        <div style="grid-column: 1/-1; margin-top: 15px;">
            {% if tem_prev %}
                <a class="btn" href="{{ url_for('pagina_vagas', pagina=pagina-1, q=filtros.q, cidade=filtros.cidade, categoria=filtros.categoria, horario=filtros.horario, tipo=filtros.tipo) }}">‚¨Ö Anterior</a>
            {% endif %}
            {% if tem_next %}
                <a class="btn" href="{{ url_for('pagina_vagas', pagina=pagina+1, q=filtros.q, cidade=filtros.cidade, categoria=filtros.categoria, horario=filtros.horario, tipo=filtros.tipo) }}">Seguinte ‚û°</a>
            {% endif %}
        </div>
    </section>
</div>
{% endblock %}
